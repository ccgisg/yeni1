<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İşyeri Hekimliği Kayıt Programı</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            display: flex;
            min-height: 100vh;
        }
        .sidebar {
            width: 200px;
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            position: relative;
        }
        .main-content {
            flex: 1;
            padding: 20px;
            position: relative;
        }
        .button {
            display: block;
            width: 90%;
            padding: 10px;
            margin: 10px auto;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #2980b9;
            cursor: pointer;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .login-container {
            width: 300px;
            margin: 100px auto;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .login-container input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box;
        }
        .login-container button {
            width: 100%;
            padding: 10px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .date-input {
            display: flex;
            align-items: center;
        }
        .date-input input {
            width: 40px;
            text-align: center;
        }
        .date-input span {
            margin: 0 5px;
        }
        .sub-directory {
            padding-left: 20px;
            display: none;
        }
        .sub-directory button {
            background-color: #34495e;
            width: 80%;
        }
        .settings-panel {
            display: none;
            background-color: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            position: absolute;
            top: 80px;
            right: 20px;
            width: 300px;
            z-index: 100;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 50;
        }
        .workers-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .workers-table th, .workers-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .workers-table th {
            background-color: #3498db;
            color: white;
        }
        .workers-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .workers-table tr:hover {
            background-color: #ddd;
        }
        .table-button {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .table-button.edit {
            background-color: #f39c12;
            color: white;
        }
        .table-button.view {
            background-color: #3498db;
            color: white;
        }
        .table-button.upload {
            background-color: #2ecc71;
            color: white;
        }
        .table-button.scan {
            background-color: #9b59b6;
            color: white;
        }
        .workplace-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .monthly-activities {
            display: none;
            padding-left: 20px;
        }
        .ek2-form-container {
            display: none;
            background-color: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0,0,0,0.1);
            max-height: 80vh;
            overflow-y: auto;
        }
        .ek2-form-container table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        .ek2-form-container th, .ek2-form-container td {
            border: 1px solid black;
            padding: 5px;
            vertical-align: top;
        }
        .ek2-form-container th {
            background-color: #f2f2f2;
        }
        .ek2-form-container .underline {
            border-bottom: 1px solid black;
            display: inline-block;
            min-width: 100px;
        }
        .ek2-form-container .checkbox {
            width: 15px;
            height: 15px;
            border: 1px solid black;
            display: inline-block;
            margin-right: 5px;
        }
        .ek2-form-container .signature-box {
            margin-top: 50px;
            border-top: 1px solid black;
            width: 200px;
            text-align: center;
            padding-top: 5px;
        }
    </style>
</head>
<body>
    <div id="login-page" class="login-container">
        <h2>Giriş Yap</h2>
        <input type="password" id="password" placeholder="Şifre">
        <button onclick="login()">Giriş Yap</button>
    </div>

    <div id="main-app" class="container" style="display: none;">
        <div class="sidebar">
            <button class="button" onclick="addWorkplace()">İşyeri Ekle</button>
            <button class="button" onclick="editWorkplace()">İşyeri Değiştir</button>
            <button class="button" id="workplaces-btn" onclick="toggleSubDirectory()">İşyerlerim ▼</button>
            <div id="sub-directory" class="sub-directory">
                <!-- Sub-directory items will be added dynamically -->
            </div>
            <button class="button" style="position: absolute; bottom: 70px; left: 20px;" onclick="toggleSettings()">AYARLAR</button>
            <button class="button" style="position: absolute; bottom: 20px; left: 20px; background-color: #e74c3c;" onclick="logout()">Çıkış Yap</button>
        </div>

        <div class="main-content">
            <div class="top-bar">
                <div>
                    <button class="button" style="display: inline-block; width: auto;" onclick="backupData()">Yedek Al</button>
                    <button class="button" style="display: inline-block; width: auto; margin-left: 10px;" onclick="restoreData()">Yedekten Dön</button>
                </div>
                <div id="current-date"></div>
            </div>

            <div id="content-area">
                <h2>Hoş Geldiniz</h2>
                <p>Sol menüden işlem seçiniz.</p>
            </div>

            <div id="modal-overlay" class="modal-overlay" onclick="closeSettings()"></div>
            
            <div id="settings-panel" class="settings-panel">
                <span class="close-btn" onclick="closeSettings()">&times;</span>
                <h3>Ayarlar</h3>
                <label for="doctor-name">Doktor İsmi:</label>
                <input type="text" id="doctor-name">
                
                <label for="certificate-no">Sertifika No:</label>
                <input type="text" id="certificate-no">
                
                <label for="certificate-date">Sertifika Tarihi:</label>
                <div class="date-input">
                    <input type="text" id="cert-day" maxlength="2" placeholder="gg" oninput="autoDot('cert-day', 'cert-month')">
                    <span>.</span>
                    <input type="text" id="cert-month" maxlength="2" placeholder="aa" oninput="autoDot('cert-month', 'cert-year')">
                    <span>.</span>
                    <input type="text" id="cert-year" maxlength="4" placeholder="yyyy">
                </div>
                
                <label for="diploma-no">Diploma No:</label>
                <input type="text" id="diploma-no">
                
                <label for="diploma-date">Diploma Tarihi:</label>
                <input type="text" id="diploma-date">
                
                <label for="registration-no">Tescil No:</label>
                <input type="text" id="registration-no">
                
                <label for="registration-date">Tescil Tarihi:</label>
                <input type="text" id="registration-date">
                
                <button class="button" onclick="saveSettings()">Ayarları Kaydet</button>
            </div>

            <div id="ek2-form-container" class="ek2-form-container">
                <!-- EK-2 form will be loaded here dynamically -->
                <button class="button" onclick="closeEk2Form()">EK-2 Formunu Kapat</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let workplaces = JSON.parse(localStorage.getItem('workplaces')) || [];
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            doctorName: 'Dr. Ahmet Yılmaz',
            certificateNo: 'HEK-12345',
            certificateDate: '15.06.2020',
            diplomaNo: '',
            diplomaDate: '',
            registrationNo: '',
            registrationDate: ''
        };
        let currentWorkplaceId = null;
        let currentWorkerId = null;

        // Login function
        function login() {
            const password = document.getElementById('password').value;
            if (password === '123456') {
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('main-app').style.display = 'flex';
                updateCurrentDate();
                loadSettings();
                showMainPage();
            } else {
                alert('Hatalı şifre! Lütfen tekrar deneyin.');
            }
        }

        // Show main page
        function showMainPage() {
            document.getElementById('content-area').innerHTML = `
                <h2>Hoş Geldiniz</h2>
                <p>Sol menüden işlem seçiniz.</p>
            `;
            currentWorkplaceId = null;
            document.getElementById('ek2-form-container').style.display = 'none';
        }

        // Logout function
        function logout() {
            document.getElementById('login-page').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
            document.getElementById('password').value = '';
            closeSettings();
            closeEk2Form();
        }

        // Toggle sub-directory
        function toggleSubDirectory() {
            const subDir = document.getElementById('sub-directory');
            const btn = document.getElementById('workplaces-btn');
            
            if (subDir.style.display === 'block') {
                subDir.style.display = 'none';
                btn.innerHTML = 'İşyerlerim ▼';
            } else {
                subDir.style.display = 'block';
                btn.innerHTML = 'İşyerlerim ▲';
                loadWorkplaces();
            }
        }

        // Auto add dot in date inputs
        function autoDot(currentField, nextField) {
            const current = document.getElementById(currentField);
            if (current.value.length === 2) {
                document.getElementById(nextField).focus();
            }
        }

        // Update current date
        function updateCurrentDate() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            document.getElementById('current-date').textContent = `${day}.${month}.${year}`;
        }

        // Toggle settings panel
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            const overlay = document.getElementById('modal-overlay');
            
            if (panel.style.display === 'block') {
                panel.style.display = 'none';
                overlay.style.display = 'none';
            } else {
                panel.style.display = 'block';
                overlay.style.display = 'block';
                loadSettings();
            }
        }

        // Close settings panel
        function closeSettings() {
            document.getElementById('settings-panel').style.display = 'none';
            document.getElementById('modal-overlay').style.display = 'none';
        }

        // Close EK-2 form
        function closeEk2Form() {
            document.getElementById('ek2-form-container').style.display = 'none';
            if (currentWorkplaceId) {
                enterWorkplace(workplaces.find(wp => wp.id === currentWorkplaceId));
            }
        }

        // Handle ESC key press
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeSettings();
                closeEk2Form();
            }
        });

        // Backup data
        function backupData() {
            const data = {
                workplaces: workplaces,
                settings: settings
            };
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'isyeri_hekimligi_yedek_' + new Date().toISOString().slice(0,10) + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Yedekleme başarıyla tamamlandı.');
        }

        // Restore data
        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.readAsText(file, 'UTF-8');
                
                reader.onload = readerEvent => {
                    try {
                        const data = JSON.parse(readerEvent.target.result);
                        workplaces = data.workplaces || [];
                        settings = data.settings || {};
                        localStorage.setItem('workplaces', JSON.stringify(workplaces));
                        localStorage.setItem('settings', JSON.stringify(settings));
                        loadWorkplaces();
                        loadSettings();
                        alert('Yedekten dönme işlemi başarılı.');
                    } catch (error) {
                        alert('Geçersiz yedek dosyası: ' + error.message);
                    }
                };
            };
            
            input.click();
        }

        // Add workplace
        function addWorkplace() {
            document.getElementById('content-area').innerHTML = `
                <h2>Yeni İşyeri Ekle</h2>
                <form id="add-workplace-form">
                    <label for="workplace-name">İşyeri Adı:</label>
                    <input type="text" id="workplace-name" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                    
                    <label for="workplace-address">Adres:</label>
                    <textarea id="workplace-address" style="width: 100%; padding: 8px; margin: 5px 0 15px; height: 80px;"></textarea>
                    
                    <label for="contract-date">Sözleşme Tarihi:</label>
                    <div class="date-input">
                        <input type="text" id="contract-day" maxlength="2" placeholder="gg" oninput="autoDot('contract-day', 'contract-month')">
                        <span>.</span>
                        <input type="text" id="contract-month" maxlength="2" placeholder="aa" oninput="autoDot('contract-month', 'contract-year')">
                        <span>.</span>
                        <input type="text" id="contract-year" maxlength="4" placeholder="yyyy">
                    </div>
                    
                    <button type="button" class="button" onclick="saveWorkplace()">Kaydet</button>
                </form>
            `;
        }

        // Save workplace
        function saveWorkplace() {
            const name = document.getElementById('workplace-name').value;
            const address = document.getElementById('workplace-address').value;
            const day = document.getElementById('contract-day').value;
            const month = document.getElementById('contract-month').value;
            const year = document.getElementById('contract-year').value;
            
            if (!name || !address || !day || !month || !year) {
                alert('Lütfen tüm alanları doldurunuz.');
                return;
            }
            
            const newWorkplace = {
                id: Date.now(),
                name: name,
                address: address,
                contractDate: `${day.padStart(2, '0')}.${month.padStart(2, '0')}.${year}`,
                workers: [],
                monthlyActivities: {}
            };
            
            workplaces.push(newWorkplace);
            localStorage.setItem('workplaces', JSON.stringify(workplaces));
            
            loadWorkplaces();
            showMainPage();
        }

        // Edit workplace
        function editWorkplace() {
            document.getElementById('content-area').innerHTML = `
                <h2>İşyeri Düzenle</h2>
                <p>İşyeri seçiniz:</p>
                <select id="workplace-select" style="width: 100%; padding: 8px; margin: 5px 0 15px;" onchange="loadWorkplaceForEdit()">
                    <option value="">-- Seçiniz --</option>
                    ${workplaces.map(wp => `<option value="${wp.id}">${wp.name}</option>`).join('')}
                </select>
                <div id="edit-workplace-form" style="display: none;">
                    <!-- Form will be displayed when a workplace is selected -->
                </div>
            `;
        }

        // Load workplace for editing
        function loadWorkplaceForEdit() {
            const select = document.getElementById('workplace-select');
            const workplaceId = parseInt(select.value);
            const workplace = workplaces.find(wp => wp.id === workplaceId);
            
            if (!workplace) return;
            
            const [day, month, year] = workplace.contractDate.split('.');
            
            document.getElementById('edit-workplace-form').innerHTML = `
                <h3>${workplace.name} Düzenle</h3>
                <form id="edit-form">
                    <label for="edit-workplace-name">İşyeri Adı:</label>
                    <input type="text" id="edit-workplace-name" value="${workplace.name}" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                    
                    <label for="edit-workplace-address">Adres:</label>
                    <textarea id="edit-workplace-address" style="width: 100%; padding: 8px; margin: 5px 0 15px; height: 80px;">${workplace.address}</textarea>
                    
                    <label for="edit-contract-date">Sözleşme Tarihi:</label>
                    <div class="date-input">
                        <input type="text" id="edit-contract-day" maxlength="2" value="${day}" oninput="autoDot('edit-contract-day', 'edit-contract-month')">
                        <span>.</span>
                        <input type="text" id="edit-contract-month" maxlength="2" value="${month}" oninput="autoDot('edit-contract-month', 'edit-contract-year')">
                        <span>.</span>
                        <input type="text" id="edit-contract-year" maxlength="4" value="${year}">
                    </div>
                    
                    <button type="button" class="button" onclick="updateWorkplace(${workplace.id})">Güncelle</button>
                    <button type="button" class="button" style="background-color: #e74c3c;" onclick="deleteWorkplace(${workplace.id})">Sil</button>
                </form>
            `;
            
            document.getElementById('edit-workplace-form').style.display = 'block';
        }

        // Update workplace
        function updateWorkplace(id) {
            const name = document.getElementById('edit-workplace-name').value;
            const address = document.getElementById('edit-workplace-address').value;
            const day = document.getElementById('edit-contract-day').value;
            const month = document.getElementById('edit-contract-month').value;
            const year = document.getElementById('edit-contract-year').value;
            
            const index = workplaces.findIndex(wp => wp.id === id);
            if (index !== -1) {
                workplaces[index] = {
                    ...workplaces[index],
                    name: name,
                    address: address,
                    contractDate: `${day.padStart(2, '0')}.${month.padStart(2, '0')}.${year}`
                };
                
                localStorage.setItem('workplaces', JSON.stringify(workplaces));
                loadWorkplaces();
                editWorkplace();
            }
        }

        // Delete workplace
        function deleteWorkplace(id) {
            if (confirm('Bu işyerini silmek istediğinize emin misiniz?')) {
                workplaces = workplaces.filter(wp => wp.id !== id);
                localStorage.setItem('workplaces', JSON.stringify(workplaces));
                loadWorkplaces();
                editWorkplace();
            }
        }

        // Load workplaces
        function loadWorkplaces() {
            const subDir = document.getElementById('sub-directory');
            subDir.innerHTML = '';
            
            workplaces.forEach(workplace => {
                const workplaceDiv = document.createElement('div');
                workplaceDiv.style.display = 'flex';
                workplaceDiv.style.alignItems = 'center';
                
                const btn = document.createElement('button');
                btn.className = 'button';
                btn.textContent = workplace.name;
                btn.style.flex = '1';
                btn.style.textAlign = 'left';
                btn.onclick = function() {
                    showWorkplaceDetails(workplace);
                };
                
                // Add double click event
                btn.ondblclick = function() {
                    enterWorkplace(workplace);
                };
                
                workplaceDiv.appendChild(btn);
                subDir.appendChild(workplaceDiv);
            });
        }

        // Show workplace details
        function showWorkplaceDetails(workplace) {
            document.getElementById('content-area').innerHTML = `
                <h2>${workplace.name}</h2>
                <p><strong>Adres:</strong> ${workplace.address}</p>
                <p><strong>Sözleşme Tarihi:</strong> ${workplace.contractDate}</p>
                <p><strong>Çalışan Sayısı:</strong> ${workplace.workers ? workplace.workers.length : 0}</p>
                <button class="button" onclick="enterWorkplace(${JSON.stringify(workplace)})">İşyerine Git</button>
                <button class="button" onclick="editWorkplace()">Düzenle</button>
            `;
        }

        // Enter workplace
        function enterWorkplace(workplace) {
            currentWorkplaceId = workplace.id;
            document.getElementById('ek2-form-container').style.display = 'none';
            
            document.getElementById('content-area').innerHTML = `
                <div class="workplace-header">
                    <h2>${workplace.name}</h2>
                    <div>
                        <button class="button" style="display: inline-block; width: auto;" onclick="importFromExcel()">Excel'den Al</button>
                        <button class="button" style="display: inline-block; width: auto; margin-left: 10px;" onclick="exportToExcel()">Excel'e Ver</button>
                    </div>
                </div>
                
                <button class="button" onclick="addWorker()">Yeni Çalışan Ekle</button>
                
                <button class="button" id="monthly-activities-btn" onclick="toggleMonthlyActivities()">Aylık Çalışmalarım ▼</button>
                <div id="monthly-activities" class="monthly-activities">
                    <!-- Monthly activities will be added here -->
                </div>
                
                <table class="workers-table">
                    <thead>
                        <tr>
                            <th>S.No</th>
                            <th>Ad Soyad</th>
                            <th>TC Kimlik No</th>
                            <th>EK-2</th>
                            <th>EK-2 Yükle</th>
                            <th>EK-2 Göster</th>
                            <th>Taranmış EK-2</th>
                            <th>Düzenle</th>
                        </tr>
                    </thead>
                    <tbody id="workers-list">
                        <!-- Workers will be added here -->
                    </tbody>
                </table>
            `;
            
            loadWorkers();
        }

        // Toggle monthly activities
        function toggleMonthlyActivities() {
            const activitiesDiv = document.getElementById('monthly-activities');
            const btn = document.getElementById('monthly-activities-btn');
            
            if (activitiesDiv.style.display === 'block') {
                activitiesDiv.style.display = 'none';
                btn.innerHTML = 'Aylık Çalışmalarım ▼';
            } else {
                activitiesDiv.style.display = 'block';
                btn.innerHTML = 'Aylık Çalışmalarım ▲';
                loadMonthlyActivities();
            }
        }

        // Load monthly activities
        function loadMonthlyActivities() {
            const workplace = workplaces.find(wp => wp.id === currentWorkplaceId);
            if (!workplace) return;
            
            const activitiesDiv = document.getElementById('monthly-activities');
            activitiesDiv.innerHTML = `
                <h3>Aylık Çalışmalar</h3>
                <p>Bu bölüm aylık çalışmalarınızı listeleyecektir.</p>
                <!-- Add your monthly activities content here -->
            `;
        }

        // Add worker
        function addWorker() {
            document.getElementById('content-area').innerHTML = `
                <h2>Yeni Çalışan Ekle</h2>
                <form id="add-worker-form">
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label for="worker-name">Adı Soyadı:</label>
                            <input type="text" id="worker-name" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                        </div>
                        <div class="form-group">
                            <label for="worker-tc">TC Kimlik No:</label>
                            <input type="text" id="worker-tc" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                        </div>
                    </div>
                    
                    <button type="button" class="button" onclick="saveWorker()">Kaydet</button>
                    <button type="button" class="button" style="background-color: #e74c3c;" onclick="enterWorkplace(workplaces.find(wp => wp.id === currentWorkplaceId))">İptal</button>
                </form>
            `;
        }

        // Save worker
        function saveWorker() {
            const name = document.getElementById('worker-name').value;
            const tc = document.getElementById('worker-tc').value;
            
            if (!name || !tc) {
                alert('Lütfen tüm alanları doldurunuz.');
                return;
            }
            
            const newWorker = {
                id: Date.now(),
                name: name,
                tc: tc,
                ek2: null,
                scannedEk2: null
            };
            
            const workplaceIndex = workplaces.findIndex(wp => wp.id === currentWorkplaceId);
            if (workplaceIndex !== -1) {
                if (!workplaces[workplaceIndex].workers) {
                    workplaces[workplaceIndex].workers = [];
                }
                workplaces[workplaceIndex].workers.push(newWorker);
                localStorage.setItem('workplaces', JSON.stringify(workplaces));
                enterWorkplace(workplaces[workplaceIndex]);
            }
        }

        // Load workers
        function loadWorkers() {
            const workplace = workplaces.find(wp => wp.id === currentWorkplaceId);
            if (!workplace || !workplace.workers) return;
            
            const workersList = document.getElementById('workers-list');
            workersList.innerHTML = '';
            
            workplace.workers.forEach((worker, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${worker.name}</td>
                    <td>${worker.tc}</td>
                    <td><button class="table-button" onclick="generateEk2(${worker.id})">EK-2 Oluştur</button></td>
                    <td><button class="table-button upload" onclick="uploadEk2(${worker.id})">Yükle</button></td>
                    <td><button class="table-button view" onclick="viewEk2(${worker.id})">Göster</button></td>
                    <td><button class="table-button scan" onclick="viewScannedEk2(${worker.id})">Göster</button></td>
                    <td><button class="table-button edit" onclick="editWorker(${worker.id})">Düzenle</button></td>
                `;
                
                workersList.appendChild(row);
            });
        }

        // Generate EK-2 form
        function generateEk2(workerId) {
            const workplace = workplaces.find(wp => wp.id === currentWorkplaceId);
            if (!workplace) return;
            
            const worker = workplace.workers.find(w => w.id === workerId);
            if (!worker) return;
            
            currentWorkerId = workerId;
            
            // Format today's date
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const formattedDate = `${day}.${month}.${year}`;
            
            document.getElementById('ek2-form-container').innerHTML = `
                <h2>EK-2 Periyodik Muayene Formu</h2>
                <button class="button" onclick="closeEk2Form()">EK-2 Formunu Kapat</button>
                <button class="button" onclick="printEk2Form()">Yazdır</button>
                
                <table>
                    <colgroup>
                        <col style="width: 16%">
                        <col style="width: 1%">
                        <col style="width: 2%">
                        <col style="width: 0%">
                        <col style="width: 7%">
                        <col style="width: 0%">
                        <col style="width: 3%">
                        <col style="width: 2%">
                        <col style="width: 1%">
                        <col style="width: 2%">
                        <col style="width: 6%">
                        <col style="width: 1%">
                        <col style="width: 2%">
                        <col style="width: 2%">
                        <col style="width: 7%">
                        <col style="width: 8%">
                        <col style="width: 0%">
                        <col style="width: 2%">
                        <col style="width: 5%">
                        <col style="width: 20%">
                    </colgroup>
                    <thead>
                        <tr>
                            <th colspan="18" class="bold">İŞYERİNİN</th>
                            <th colspan="2" rowspan="9" class="no-border"></th>
                        </tr>
                        <tr>
                            <th colspan="2">Ünvanı</th>
                            <td colspan="16">${workplace.name}</td>
                        </tr>
                        <tr>
                            <th colspan="2">SGK Sicil No.</th>
                            <td colspan="16"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <th colspan="2">Adresi</th>
                            <td colspan="16">${workplace.address}</td>
                        </tr>
                        <tr>
                            <th colspan="2">Tel ve Faks No</th>
                            <td colspan="16" class="bold">/</td>
                        </tr>
                        <tr>
                            <th colspan="2">E-Posta</th>
                            <td colspan="16"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="18">
                                <p>İşe giriş/periyodik muayene olmayı kabul ettiğimi ve muayene sırasında verdiğim bilgilerin doğru ve eksiksiz olduğunu beyan ederim.</p>
                                <p>Çalışanın Adı Soyadı</p>
                                <p>İMZA</p>
                                <p class="bold">ÇALIŞANIN</p>
                            </td>
                        </tr>
                        <tr>
                            <th colspan="5">Adı ve soyadı</th>
                            <td colspan="13" class="bold">${worker.name}</td>
                        </tr>
                        <tr>
                            <th colspan="5">T.C.Kimlik No</th>
                            <td colspan="13" class="bold">${worker.tc}</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="5">Doğum Yeri ve Tarihi</td>
                            <td colspan="15"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="5">Cinsiyeti</td>
                            <td colspan="15"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="5">Eğitim durumu</td>
                            <td colspan="15"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="5">Medeni durumu</td>
                            <td colspan="4"><span class="underline"></span></td>
                            <td colspan="4">Çocuk sayısı</td>
                            <td colspan="7"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="5">Ev Adresi</td>
                            <td colspan="15"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="5">Tel No.</td>
                            <td colspan="15"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="5">Mesleği</td>
                            <td colspan="15"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="5">Yaptığı iş (Ayrıntılı olarak tanımlanacaktır.)</td>
                            <td colspan="15"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="5">Çalıştığı bölüm</td>
                            <td colspan="15"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="3">Daha önce çalıştığı yerler(Bu günden geçmişe doğru)</td>
                            <td colspan="5">İşkolu</td>
                            <td colspan="9">Yaptığı iş</td>
                            <td colspan="3">Giriş-çıkış tarihi</td>
                        </tr>
                        <tr>
                            <td colspan="3">1.</td>
                            <td colspan="5"><span class="underline"></span></td>
                            <td colspan="9"><span class="underline"></span></td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="3">2.</td>
                            <td colspan="5"><span class="underline"></span></td>
                            <td colspan="9"><span class="underline"></span></td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="3">3.</td>
                            <td colspan="5"><span class="underline"></span></td>
                            <td colspan="9"><span class="underline"></span></td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="3" class="bold">Özgeçmişi</td>
                            <td colspan="17"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="3">Kan grubu</td>
                            <td colspan="17"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="3">Konjenital/kronik hastalık</td>
                            <td colspan="17"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="20">Bağışıklama</td>
                        </tr>
                        <tr>
                            <td class="indent">- Tetanoz</td>
                            <td colspan="19"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td class="indent">- Hepatit</td>
                            <td colspan="19"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td class="indent">- Diğer</td>
                            <td colspan="19"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="20" class="bold">Soygeçmişi</td>
                        </tr>
                        <tr>
                            <td colspan="4">Anne</td>
                            <td colspan="7">Baba</td>
                            <td colspan="5">Kardeş</td>
                            <td colspan="4">Çocuk</td>
                        </tr>
                        <tr>
                            <td colspan="4"><span class="underline"></span></td>
                            <td colspan="7"><span class="underline"></span></td>
                            <td colspan="5"><span class="underline"></span></td>
                            <td colspan="4"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="4"><span class="underline"></span></td>
                            <td colspan="7"><span class="underline"></span></td>
                            <td colspan="5"><span class="underline"></span></td>
                            <td colspan="4"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="4"><span class="underline"></span></td>
                            <td colspan="7"><span class="underline"></span></td>
                            <td colspan="5"><span class="underline"></span></td>
                            <td colspan="4"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="20" class="bold">TIBBİ ANAMNEZ</td>
                        </tr>
                        <tr>
                            <td colspan="15">1. Aşağıdaki yakınmalardan herhangi birini yaşadınız mı?</td>
                            <td colspan="4" class="text-center">Hayır</td>
                            <td class="text-center">Evet</td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Balgamlı öksürük</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Nefes darlığı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Göğüs ağrısı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Çarpıntı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Sırt ağrısı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- İshal veya kabızlık</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Eklemlerde ağrı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">-Diğer (belirtiniz)</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15">2. Aşağıdaki hastalıklardan herhangi birini geçirdiniz mi?</td>
                            <td colspan="4" class="text-center">Hayır</td>
                            <td class="text-center">Evet</td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Kalp hastalığı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Şeker hastalığı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Böbrek rahatsızlığı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Sarılık</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Mide veya on iki parmak ülseri</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- İşitme kaybı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Görme bozukluğu</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Sinir sistemi hastalığı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Deri hastalığı</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">- Besin zehirlenmesi</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="15" class="indent">-Diğer (belirtiniz)</td>
                            <td colspan="4" class="text-center"><span class="checkbox"></span></td>
                            <td class="text-center"><span class="checkbox"></span></td>
                        </tr>
                        <tr>
                            <td colspan="10">3. Hastanede yattınız mı?</td>
                            <td colspan="2">Hayır</td>
                            <td colspan="2" class="text-center"><span class="checkbox"></span></td>
                            <td colspan="3">Evet, ise tanı?</td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="10">4. Ameliyat geçirdiniz mi?</td>
                            <td colspan="2">Hayır</td>
                            <td colspan="2" class="text-center"><span class="checkbox"></span></td>
                            <td colspan="3">Evet, ise neden?</td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="10">5. İş kazası geçirdiniz mi?</td>
                            <td colspan="2">Hayır</td>
                            <td colspan="2" class="text-center"><span class="checkbox"></span></td>
                            <td colspan="3">Evet, ise ne oldu?</td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="10">6. Meslek Hastalıkları şüphesi ile ilgili tetkik ve muayeneye tabi tutuldunuz mu?</td>
                            <td colspan="2">Hayır</td>
                            <td colspan="2" class="text-center"><span class="checkbox"></span></td>
                            <td colspan="3">Evet, ise sonuç?</td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="10">7. Maluliyet aldınız mı?</td>
                            <td colspan="2">Hayır</td>
                            <td colspan="2" class="text-center"><span class="checkbox"></span></td>
                            <td colspan="3">Evet, ise nedir ve oranı?</td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="10">8. Şu anda herhangi bir tedavi görüyor musunuz?</td>
                            <td colspan="2">Hayır</td>
                            <td colspan="2" class="text-center"><span class="checkbox"></span></td>
                            <td colspan="3">Evet, ise nedir?</td>
                            <td colspan="3"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="3">9. Sigara içiyor musunuz?</td>
                            <td colspan="3">Hayır</td>
                            <td class="text-center"><span class="checkbox"></span></td>
                            <td colspan="13"></td>
                        </tr>
                        <tr>
                            <td colspan="3"></td>
                            <td colspan="3">Bırakmış</td>
                            <td class="text-center"><span class="checkbox"></span></td>
                            <td colspan="6">..........ay/yıl önce</td>
                            <td colspan="4">.............ay/yıl içmiş</td>
                            <td colspan="3">...........adet/gün içmiş</td>
                        </tr>
                        <tr>
                            <td colspan="3"></td>
                            <td colspan="3">Evet</td>
                            <td class="text-center"><span class="checkbox"></span></td>
                            <td colspan="6">..........yıldır</td>
                            <td colspan="7">..............adet/gün</td>
                        </tr>
                        <tr>
                            <td colspan="3">10. Alkol alıyor musunuz?</td>
                            <td colspan="3">Hayır</td>
                            <td class="text-center"><span class="checkbox"></span></td>
                            <td colspan="13"></td>
                        </tr>
                        <tr>
                            <td colspan="3"></td>
                            <td colspan="3">Bırakmış</td>
                            <td class="text-center"><span class="checkbox"></span></td>
                            <td colspan="6">..............yıl önce</td>
                            <td colspan="4">..............yıl içmiş</td>
                            <td colspan="3">................sıklıkla içmiş</td>
                        </tr>
                        <tr>
                            <td colspan="3"></td>
                            <td colspan="3">Evet</td>
                            <td class="text-center"><span class="checkbox"></span></td>
                            <td colspan="6">..........yıldır</td>
                            <td colspan="7">..............sıklıkla</td>
                        </tr>
                        <tr>
                            <td colspan="20" class="bold">FİZİK MUAYENE SONUÇLARI</td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">a) Duyu organları</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">- Göz</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">- Kulak-Burun-Boğaz</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">- Deri</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6">b) Kardiyovasküler sistem muayenesi</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6">c) Solunum sistemi muayenesi</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6">d) Sindirim sistemi muayenesi</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6">e) Ürogenital sistem muayenesi</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6">f) Kas-iskelet sistemi muayenesi</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">g) Nörolojik muayene</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">ğ) Psikiyatrik muayene</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">h) Diğer</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="20">-TA : / mm-Hg</td>
                        </tr>
                        <tr>
                            <td colspan="20">-Nb : / dk.</td>
                        </tr>
                        <tr>
                            <td colspan="20">-Boy: Kilo: Vücut Kitle İndeksi :</td>
                        </tr>
                        <tr>
                            <td colspan="20" class="bold">LABORATUVAR BULGULARI</td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">a) Biyolojik analizler</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">- Kan</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">- İdrar</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">b) Radyolojik analizler</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">c) Fizyolojik analizler</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">- Odyometre</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">- SFT</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">d) Psikolojik testler</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                        <tr>
                            <td colspan="6" class="indent">e) Diğer</td>
                            <td colspan="14"><span class="underline"></span></td>
                        </tr>
                    </tbody>
                </table>

                <div class="bold">KANAAT VE SONUÇ * :</div>
                <p class="bold">1- ...................................................................................................................................................... işinde bedenen ve ruhen çalışmaya elverişlidir.</p>
                <p class="bold">2- ................................................................................................................................... şartı ile çalışmaya elverişlidir</p>
                <p>(<span class="bold">*</span>Yapılan muayene sonucunda çalışanın gece veya vardiyalı çalışma koşullarında çalışıp çalışamayacağı ile vücut sağlığını ve bütünlüğünü tamamlayıcı uygun alet teçhizat vs... bulunması durumunda çalışan için bu koşullarla çalışmaya elverişli olup olmadığı kanaati belirtilecektir.)</p>

                <p>${formattedDate}</p>

                <div class="signature-box">
                    İMZA
                </div>
                <div class="signature-box">
                    Adı ve Soyadı: ${settings.doctorName || ''}
                </div>
                <div class="signature-box">
                    Diploma Tarih ve No: ${settings.diplomaDate || ''} / ${settings.diplomaNo || ''}
                </div>
                <div class="signature-box">
                    Diploma Tescil Tarih ve No: ${settings.registrationDate || ''} / ${settings.registrationNo || ''}
                </div>
                <div class="signature-box">
                    İşyeri Hekimliği Belgesi Tarih ve No: ${settings.certificateDate || ''} / ${settings.certificateNo || ''}
                </div>
            `;
            
            document.getElementById('ek2-form-container').style.display = 'block';
        }

        // Print EK-2 form
        function printEk2Form() {
            const printContent = document.getElementById('ek2-form-container').innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            
            // Reload the form
            generateEk2(currentWorkerId);
        }

        // Upload EK-2
        function uploadEk2(workerId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.pdf,.doc,.docx';
            
            input.onchange = e => {
                const file = e.target.files[0];
                if (file) {
                    const workplaceIndex = workplaces.findIndex(wp => wp.id === currentWorkplaceId);
                    if (workplaceIndex !== -1) {
                        const workerIndex = workplaces[workplaceIndex].workers.findIndex(w => w.id === workerId);
                        if (workerIndex !== -1) {
                            workplaces[workplaceIndex].workers[workerIndex].ek2 = file.name;
                            localStorage.setItem('workplaces', JSON.stringify(workplaces));
                            loadWorkers();
                            alert('EK-2 formu başarıyla yüklendi.');
                        }
                    }
                }
            };
            
            input.click();
        }

        // View EK-2
        function viewEk2(workerId) {
            const workplace = workplaces.find(wp => wp.id === currentWorkplaceId);
            if (!workplace) return;
            
            const worker = workplace.workers.find(w => w.id === workerId);
            if (!worker) return;
            
            if (worker.ek2) {
                alert(`${worker.name} için EK-2 formu gösterilecek: ${worker.ek2}`);
                // Here you would implement the actual EK-2 viewing
            } else {
                alert('Bu çalışan için yüklenmiş EK-2 formu bulunamadı.');
            }
        }

        // View scanned EK-2
        function viewScannedEk2(workerId) {
            const workplace = workplaces.find(wp => wp.id === currentWorkplaceId);
            if (!workplace) return;
            
            const worker = workplace.workers.find(w => w.id === workerId);
            if (!worker) return;
            
            if (worker.scannedEk2) {
                alert(`${worker.name} için taranmış EK-2 formu gösterilecek: ${worker.scannedEk2}`);
                // Here you would implement the actual scanned EK-2 viewing
            } else {
                alert('Bu çalışan için taranmış EK-2 formu bulunamadı.');
            }
        }

        // Edit worker
        function editWorker(workerId) {
            const workplace = workplaces.find(wp => wp.id === currentWorkplaceId);
            if (!workplace) return;
            
            const worker = workplace.workers.find(w => w.id === workerId);
            if (!worker) return;
            
            document.getElementById('content-area').innerHTML = `
                <h2>Çalışan Düzenle</h2>
                <form id="edit-worker-form">
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <label for="edit-worker-name">Adı Soyadı:</label>
                            <input type="text" id="edit-worker-name" value="${worker.name}" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                        </div>
                        <div class="form-group">
                            <label for="edit-worker-tc">TC Kimlik No:</label>
                            <input type="text" id="edit-worker-tc" value="${worker.tc}" style="width: 100%; padding: 8px; margin: 5px 0 15px;">
                        </div>
                    </div>
                    
                    <button type="button" class="button" onclick="updateWorker(${workerId})">Güncelle</button>
                    <button type="button" class="button" style="background-color: #e74c3c;" onclick="deleteWorker(${workerId})">Sil</button>
                    <button type="button" class="button" onclick="enterWorkplace(workplace)">İptal</button>
                </form>
            `;
        }

        // Update worker
        function updateWorker(workerId) {
            const name = document.getElementById('edit-worker-name').value;
            const tc = document.getElementById('edit-worker-tc').value;
            
            if (!name || !tc) {
                alert('Lütfen tüm alanları doldurunuz.');
                return;
            }
            
            const workplaceIndex = workplaces.findIndex(wp => wp.id === currentWorkplaceId);
            if (workplaceIndex !== -1) {
                const workerIndex = workplaces[workplaceIndex].workers.findIndex(w => w.id === workerId);
                if (workerIndex !== -1) {
                    workplaces[workplaceIndex].workers[workerIndex] = {
                        ...workplaces[workplaceIndex].workers[workerIndex],
                        name: name,
                        tc: tc
                    };
                    
                    localStorage.setItem('workplaces', JSON.stringify(workplaces));
                    enterWorkplace(workplaces[workplaceIndex]);
                }
            }
        }

        // Delete worker
        function deleteWorker(workerId) {
            if (confirm('Bu çalışanı silmek istediğinize emin misiniz?')) {
                const workplaceIndex = workplaces.findIndex(wp => wp.id === currentWorkplaceId);
                if (workplaceIndex !== -1) {
                    workplaces[workplaceIndex].workers = workplaces[workplaceIndex].workers.filter(w => w.id !== workerId);
                    localStorage.setItem('workplaces', JSON.stringify(workplaces));
                    enterWorkplace(workplaces[workplaceIndex]);
                }
            }
        }

        // Import from Excel
        function importFromExcel() {
            alert('Excel\'den veri almak için işlevsellik buraya eklenecek.');
            // Implement actual Excel import functionality
        }

        // Export to Excel
        function exportToExcel() {
            alert('Excel\'e veri aktarmak için işlevsellik buraya eklenecek.');
            // Implement actual Excel export functionality
        }

        // Load settings
        function loadSettings() {
            if (settings.certificateDate) {
                const [day, month, year] = settings.certificateDate.split('.');
                document.getElementById('doctor-name').value = settings.doctorName || '';
                document.getElementById('certificate-no').value = settings.certificateNo || '';
                document.getElementById('cert-day').value = day || '';
                document.getElementById('cert-month').value = month || '';
                document.getElementById('cert-year').value = year || '';
                document.getElementById('diploma-no').value = settings.diplomaNo || '';
                document.getElementById('diploma-date').value = settings.diplomaDate || '';
                document.getElementById('registration-no').value = settings.registrationNo || '';
                document.getElementById('registration-date').value = settings.registrationDate || '';
            }
        }

        // Save settings
        function saveSettings() {
            const day = document.getElementById('cert-day').value;
            const month = document.getElementById('cert-month').value;
            const year = document.getElementById('cert-year').value;
            
            settings = {
                doctorName: document.getElementById('doctor-name').value,
                certificateNo: document.getElementById('certificate-no').value,
                certificateDate: `${day.padStart(2, '0')}.${month.padStart(2, '0')}.${year}`,
                diplomaNo: document.getElementById('diploma-no').value,
                diplomaDate: document.getElementById('diploma-date').value,
                registrationNo: document.getElementById('registration-no').value,
                registrationDate: document.getElementById('registration-date').value
            };
            
            localStorage.setItem('settings', JSON.stringify(settings));
            alert('Ayarlar başarıyla kaydedildi.');
            closeSettings();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load any saved data
            if (localStorage.getItem('workplaces')) {
                workplaces = JSON.parse(localStorage.getItem('workplaces'));
            }
            
            if (localStorage.getItem('settings')) {
                settings = JSON.parse(localStorage.getItem('settings'));
            }
            
            // Set cursor pointer for all buttons
            const buttons = document.querySelectorAll('.button, .table-button');
            buttons.forEach(button => {
                button.style.cursor = 'pointer';
            });
            
            // Close settings when clicking outside
            document.addEventListener('click', function(event) {
                const panel = document.getElementById('settings-panel');
                const overlay = document.getElementById('modal-overlay');
                if (event.target === overlay && panel.style.display === 'block') {
                    closeSettings();
                }
            });
        });
    </script>
</body>
</html>
